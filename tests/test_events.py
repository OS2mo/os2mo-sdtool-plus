# SPDX-FileCopyrightText: Magenta ApS <https://magenta.dk>
# SPDX-License-Identifier: MPL-2.0
from unittest.mock import MagicMock

import pytest
from fastramqpi.config import Settings as FastRAMQPISettings
from fastramqpi.events import Event
from fastramqpi.ramqp.config import AMQPConnectionSettings
from sdclient.client import SDClient

from sdtoolplus.autogenerated_graphql_client import GraphQLClient
from sdtoolplus.config import SDToolPlusSettings
from sdtoolplus.events import _sd_employment
from sdtoolplus.exceptions import EngagementSyncTemporarilyDisabled


async def test__sd_employment_raises_exception():
    with pytest.raises(EngagementSyncTemporarilyDisabled):
        await _sd_employment(
            settings=SDToolPlusSettings(
                sd_username="username",
                sd_password="secret",
                sd_institution_identifier="II",
                db_password="secret",
                obsolete_unit_roots=[],
                fastramqpi=FastRAMQPISettings(
                    client_id="id",
                    client_secret="secret",
                    amqp=AMQPConnectionSettings(url="amqp://guest:guest@sd-amqp:5672/"),
                ),
                recalc_mo_unit_when_sd_employment_moved=False,
            ),
            sd_client=MagicMock(spec=SDClient),
            gql_client=MagicMock(spec=GraphQLClient),
            event=MagicMock(spec=Event),
        )
